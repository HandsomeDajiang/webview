<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <META HTTP-EQUIV="pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT= "no-cache, must-revalidate">
    <title>xyz</title>
</head>
<script src="macOsInject.js"></script>
<script src="test.js"></script>
<body>
    <div>
        <button onclick="closeWindow()">关闭窗口</button>
        <button id="btn" onclick="getToken()">getToken</button>
        <textarea name="textarea" id="text" cols="30" rows="10"></textarea>
        <button onclick="removeToken()">removeToken</button>
        <a href="https://www.baidu.com/">跳转百12313123度</a>
        <a href="https://www.baidu.com/">ggg</a>
    </div>
</body>
</html>
<script>
    function setupWKWebViewJavascriptBridge(callback) {
        if (window.WKWebViewJavascriptBridge) {
            return callback(window.WKWebViewJavascriptBridge);
        }
        if (window.WKWVJBCallbacks) {
            return window.WKWVJBCallbacks.push(callback);
        }
        window.WKWVJBCallbacks = [callback];
        window.webkit.messageHandlers.iOS_Native_InjectJavascript.postMessage(null);
    }
    window.onload = function () {

        // TODO 判断设备 IOS 或者 MacOS  这边临时简单判断。
        const ua = navigator.userAgent;
        if (ua.split('Mac').length > 1){
            macOsInjectWKWebViewJavascriptBridge(); // 用于 Mac 端 初始化 WKWebViewJavascriptBridge 对象。
            return;
        }

        setupWKWebViewJavascriptBridge(function(bridge) {
            let parms = {'appId': 'b4933e7b0c12f9c16a'}
            bridge.callHandler('getMiniProgramToken', parms, function(response) {

            });
        });
    }
</script>

